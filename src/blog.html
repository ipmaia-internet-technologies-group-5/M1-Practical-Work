<!DOCTYPE html>

<html lang="en">

<head>
    <meta charset="utf-8">
    <meta http-equiv="x-ua-compatible" content="ie=edge">

    <title>SaveTheForest | Blog</title>

    <meta name="description" content="">
    <meta name="viewport" content="width=device-width, initial-scale=1">

    <link rel="shortcut icon" type="image/x-icon" href="assets/img/icon.png">

    <link rel="stylesheet" href="assets/css/boostrap.css">
    <link rel="stylesheet" href="assets/css/template.css">
</head>

<body>
    <header>
        <div class="header-area">
            <div class="main-header">
                <div class="header-bottom  header-sticky">
                    <div class="container-fluid">
                        <div class="row align-items-center">

                            <div class="col-xl-2 col-lg-2">
                                <div class="logo">
                                    <a href="index.html"><img src="assets/img/logo/logo.png" alt=""></a>
                                </div>
                            </div>
                            <div class="col-xl-10 col-lg-10">

                                <div class="main-menu f-right d-none d-lg-block">
                                    <nav>
                                        <ul id="navigation">
                                            <li><a href="index.html">Home</a></li>
                                            <li><a href="about_us.html">About Us</a></li>
                                            <li><a href="projects.html">Projects</a></li>
                                            <li><a href="blog.html">Blog</a></li>
                                            <li><a href="contact_us.html">Contact Us</a></li>
                                            <li>
                                                <div class="header-right-btn f-right  ml-15">
                                                    <a href="donations.html" class="header-btn">Donate Now</a>
                                                </div>
                                            </li>
                                        </ul>
                                    </nav>
                                </div>
                            </div>

                            <div class="col-12">
                                <div class="mobile_menu d-block d-lg-none"></div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </header>
    <main>

        <div class="slider-area">
            <div class="slider-height2 slider-bg5 hero-overly d-flex align-items-center">
                <div class="container">
                    <div class="row align-items-center">
                        <div class="col-xl-5 col-lg-6 col-md-6">
                            <div class="hero-caption hero-caption2">
                                <h2>Blog</h2>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <section class="blog_area section-padding">
            <div class="container">
                <h3 class="mb-30">Notices</h3>
                <div class="row">
                    <div class="col-lg-8 mb-5 mb-lg-0">
                        <div class="blog_left_sidebar" id="blog-catalog"></div>
                        <div class="blog_left_sidebar">
                            <nav class="blog-pagination justify-content-center d-flex">
                                <ul class="pagination" id="blog-pagination"></ul>
                            </nav>
                        </div>
                    </div>
                    <div class="col-lg-4">
                        <div class="blog_right_sidebar">
                            <aside class="single_sidebar_widget post_category_widget">
                                <h4 class="widget_title" style="color: #2d2d2d;">Category</h4>
                                <ul class="list cat-list" id="blog-categories"></ul>
                            </aside>
                            <aside class="single_sidebar_widget newsletter_widget">
                                <h4 class="widget_title" style="color: #2d2d2d;">Newsletter</h4>
                                <form action="#">
                                    <div class="form-group">
                                        <input type="email" class="form-control" onfocus="this.placeholder = ''" onblur="this.placeholder = 'Enter email'" placeholder="Enter email" required="">
                                    </div>
                                    <button class="button rounded-0 primary-bg text-white w-100 btn_1 boxed-btn" type="submit">Subscribe</button>
                                </form>
                            </aside>
                        </div>
                    </div>
                </div>
            </div>
        </section>

    </main>
    <footer>
        <div class="footer-wrapper">
            <div class="footer-area footer-padding">
                <div class="container">
                    <div class="row justify-content-between">
                        <div class="col-xl-3 col-lg-3 col-md-6 col-sm-8">
                            <div class="single-footer-caption mb-50">
                                <div class="single-footer-caption mb-20">

                                    <div class="footer-logo mb-35">
                                        <a href="index.html"><img src="assets/img/logo/logo2.png" alt="" width="259"></a>
                                    </div>
                                    <div class="footer-tittle">
                                        <div class="footer-pera">
                                            <p>Seddo eiusmod tempor incididunt ut labore et dolore magna aliqua. Conse ctetur pisicin elit, sed do eiusmod tempor.</p>
                                        </div>
                                    </div>

                                    <div class="footer-social">
                                        <a href="../../sai4ull.html"><i class="fab fa-facebook"></i></a>
                                        <a href="#"><i class="fab fa-instagram"></i></a>
                                        <a href="#"><i class="fab fa-linkedin-in"></i></a>
                                        <a href="#"><i class="fab fa-youtube"></i></a>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="offset-xl-1 col-xl-2 col-lg-2 col-md-4 col-sm-6">
                            <div class="single-footer-caption mb-50">
                                <div class="footer-tittle">
                                    <h4>Navigation</h4>
                                    <ul>
                                        <li><a href="#">Home</a></li>
                                        <li><a href="#">About</a></li>
                                        <li><a href="#">Services</a></li>
                                        <li><a href="#">Blog</a></li>
                                        <li><a href="#">Contact</a></li>
                                    </ul>
                                </div>
                            </div>
                        </div>
                        <div class="col-xl-2 col-lg-2 col-md-4 col-sm-6">
                            <div class="single-footer-caption mb-50">
                                <div class="footer-tittle">
                                    <h4>Services</h4>
                                    <ul>
                                        <li><a href="#">Pet Care</a></li>
                                        <li><a href="#">Pet Treatment</a></li>
                                        <li><a href="#">Pet Trainingl</a></li>
                                        <li><a href="#">Hygienic Care</a></li>
                                    </ul>
                                </div>
                            </div>
                        </div>
                        <div class="col-xl-4 col-lg-4 col-md-6 col-sm-8">
                            <div class="single-footer-caption mb-50">
                                <div class="footer-tittle mb-10">
                                    <h4>Subscribe newsletter</h4>
                                    <p>Subscribe our newsletter to get updates about our services and offers.</p>
                                </div>

                                <div class="footer-form mb-20">
                                    <div id="mc_embed_signup">
                                        <form target="_blank">
                                            <input type="email" name="email" id="newsletter-form-email" placeholder="Enter your email" class="placeholder hide-on-focus">
                                            <div class="form-icon">
                                                <button type="submit" name="submit" id="newsletter-submit" class="email_icon newsletter-submit button-contactForm">
                                                    <i class="fas fa-arrow-right"></i>
                                                </button>
                                            </div>
                                            <div class="mt-10 info"></div>
                                        </form>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <div class="footer-bottom-area">
                <div class="container">
                    <div class="footer-border">
                        <div class="row">
                            <div class="col-xl-12 ">
                                <div class="footer-copy-right text-center">
                                    <p>Copyright ©2022 All rights reserved | <a>SaveTheForest</a> <i class="fa fa-heart" aria-hidden="true"></i></p>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </footer>

    <div id="back-top">
        <a title="Go to Top" href="#"> <i class="fas fa-level-up-alt"></i></a>
    </div>

    <script src="assets/js/vendor/modernizr-3.5.0.min.js"></script>
    <script src="assets/js/vendor/jquery-1.12.4.min.js"></script>
    <script src="assets/js/vendor/popper.min.js"></script>
    <script src="assets/js/vendor/owl.carousel-2.3.4.min.js"></script>
    <script src="assets/js/vendor/slick.min.js"></script>



    <script src="assets/js/vendor/jquery.slicknav.js"></script>
    <script src="assets/js/vendor/wow.min.js"></script>
    <script src="assets/js/vendor/jquery.magnific-popup-1.1.0.min.js"></script>
    <script src="assets/js/vendor/jquery.nice-select.min.js"></script>
    <script src="assets/js/vendor/jquery.counterup-1.0.0.min.js"></script>
    <script src="assets/js/vendor/waypoints.min.js"></script>
    <script src="assets/js/vendor/jquery.barfiller-1.0.1.min.js"></script>
    <script src="assets/js/contact-form.js"></script>

    <script src="assets/js/vendor/jquery.form.min.js"></script>
    <script src="assets/js/vendor/jquery.validate-1.11.1.min.js"></script>
    <script src="assets/js/mail-script.js"></script>
    <script src="assets/js/main.js"></script>

    <script src="assets/js/internal/ObjTree.js"></script>
    <script src="assets/js/internal/utilities.js"></script>

    <script>
        // Creating a XML Obj Parser instance
        const xotree = new XML.ObjTree();
        // Converting a blog.xml from xml to js object
        const blogContent = xotree.parseXML(read_from_file_sync("http://localhost/savetheforest/src/xml/blog/blog.xml"));

        let currentCategory = findGetParameter("category");
        if (currentCategory != null && currentCategory.toLowerCase() == "all") {
            currentCategory = null;
        }

        let blogNotices = fetchCurrentBlogNotices();

        // Pagination Variables
        const maxItemsPerPage = 3;
        let itemsQuantity = blogNotices.length;
        let maxPages = Math.ceil(itemsQuantity / maxItemsPerPage);

        let currentPage = parseInt(findGetParameter("page"));
        if (isNaN(currentPage)) {
            currentPage = 1;
        }
        // Forcing to check the boundaries
        setCurrentPage(currentPage);

        preparePagination(); // Preparing the pagination after showing the catalog
        prepareCatalogNotices();
        prepareCategories();

        function setCurrentPage(newPage) {
            currentPage = newPage;
            if (currentPage > maxPages) {
                currentPage = maxPages;
            }
        }

        function fetchCurrentBlogNotices() {
            function compareDates(a, b) {
                if (a == b) return 0;

                return convertToDate(b.date) > convertToDate(a.date) ? -1 : 1;
            }

            let notices = blogContent.catalog.notice;

            if (currentCategory != null) {
                notices = notices.filter((n) => n.category.toLowerCase() == currentCategory.toLowerCase());
            }

            return notices.sort(compareDates);
        }

        function prepareCatalogNotices() {
            const catalogElement = document.getElementById("blog-catalog");

            // Removing all the elements from the catalog element before adding new ones
            catalogElement.clear();

            for (var i = (currentPage - 1) * maxItemsPerPage; i < (currentPage) * maxItemsPerPage; i++) {
                if (i >= blogNotices.length) continue;
                const notice = blogNotices[i];

                const wrappedData = convertToDate(notice.date);
                let wrappedDescription = notice.description;

                if (wrappedDescription.length > 400) {
                    const shortDescription = wrappedDescription.substring(0, 400);
                    wrappedDescription = shortDescription.substring(0, shortDescription.lastIndexOf(' ')) + "...";
                }

                const htmlElement = `<article class="blog_item">
                                    <div class="blog_item_img">
                                        <img class="card-img rounded-0" src="xml/blog/images/${notice.image}" alt="">
                                        <a href="#" class="blog_item_date">
                                            <h3>${wrappedData.getDate()}</h3>
                                            <p>${wrappedData.getShortMonthName()}</p>
                                        </a>
                                    </div>
                                    <div class="blog_details">
                                        <a class="d-inline-block" href="blog_details.html">
                                            <h2 class="blog-head" style="color: #2d2d2d;">${notice.title}</h2>
                                        </a>
                                        <p>${wrappedDescription}</p>
                                        <ul class="blog-info-link">
                                            <li><a><i class="fa fa-user"></i> ${notice.publisher}</a></li>
                                            <li><a><i class="fa fa-calendar"></i>${notice.date}</a></li>
                                        </ul>
                                    </div>
                                </article>`;

                catalogElement.insertAdjacentHTML("afterbegin", htmlElement);
            }
        }

        function prepareCategories() {
            const categoriesElement = document.getElementById("blog-categories");

            const categories = new Map(); // <categoryName | amount of notices>

            categories.set("All", 0); // Adding the default category

            const notices = blogContent.catalog.notice;
            for (var i = 0; i < notices.length; i++) {
                const notice = notices[i];
                const categoryName = notice.category;

                let cachedValue = categories.get(categoryName);
                if (cachedValue == undefined) {
                    cachedValue = 0;
                }

                categories.set(notice.category, ++cachedValue);
            }

            categories.forEach((quantity, categoryName) => {
                        const htmlElement = `<li>
                                         <a href="?category=${categoryName}" class="d-flex">
                                             <p>${categoryName} ${quantity == 0 ? "" : `(${quantity})`}</p>
                                         </a>
                                     </li>`;

                categoriesElement.insertAdjacentHTML("afterbegin", htmlElement);
            });
        }

        function preparePagination() {
            function insertAfter(referenceNode, newNode) {
                referenceNode.parentNode.insertBefore(newNode, referenceNode.lastSibling);
            }

            const paginationElement = document.getElementById("blog-pagination");

            paginationElement.clear();

            const previousElement = htmlToElement(`<li class="page-item">
                                        <a href="#" class="page-link" aria-label="Previous">
                                            <i class="ti-angle-left"></i>
                                        </a>
                                    </li>`);

            previousElement.addEventListener('click', (event) => {
                event.preventDefault();

                setCurrentPage(currentPage + 1);
                updatePage();
            });

            paginationElement.appendChild(previousElement);

            for (var i = 0; i < maxPages; i++) {
                const page = i + 1;

                const itemElement = htmlToElement(`<li class="page-item ${page == currentPage ? "active" : ""}">
                                        <a class="page-link" pagination-item="${page}">${page}</a>
                                    </li>`);

                itemElement.addEventListener('click', (event) => {
                    event.preventDefault();

                    handlePaginationClick(event);
                });

                paginationElement.appendChild(itemElement);
            }

            const nextElement = htmlToElement(`<li class="page-item">
                                        <a href="#" class="page-link" aria-label="Next">
                                            <i class="ti-angle-right"></i>
                                        </a>
                                    </li>`);

            nextElement.addEventListener('click', (event) => {
                event.preventDefault();

                setCurrentPage(currentPage + 1);
                updatePage();
            });

            paginationElement.appendChild(nextElement);
        }

        function handlePaginationClick(event) {
            // Extracting the attribute from the element
            const pageAttribute = event.target.getAttribute('pagination-item');

            /* 
             * Checking if the element actually contains a page attribute 
             * (If the user clicks on the "li" element instead of clicking on the "a" element) 
             */
            if (pageAttribute == null) {
                return;
            }

            if (currentPage == pageAttribute) return;

            // Updating the current page variable
            setCurrentPage(pageAttribute);

            // Updating all notices according to the new current page
            updatePage();
        }

        function updatePage() {
            prepareCatalogNotices();
            preparePagination();

            document.getElementById("blog-categories").scrollIntoView();
        }
    </script>

</body>

</html>